#include <windows.h>
#include <intrin.h>

#pragma intrinsic(_ReturnAddress)

typedef unsigned __int64 QWORD;

typedef DWORD  (NTAPI * NtFlushInstructionCache_t)( HANDLE, PVOID, ULONG );

typedef FARPROC (WINAPI * GetProcAddress_t)( HMODULE, LPCSTR );

typedef HMODULE (WINAPI * LoadLibraryA_t)( LPCSTR );

typedef LPVOID (WINAPI * VirtualAlloc_t)( LPVOID, SIZE_T, DWORD, DWORD );


typedef struct _UNICODE_STRING {
    USHORT Length;
    USHORT MaximumLength;
    PWSTR  Buffer;
} UNICODE_STRING;

typedef struct _LDR_DATA_TABLE_ENTRY {
    LIST_ENTRY InLoadOrderLinks;
    LIST_ENTRY InMemoryOrderLinks;
    LIST_ENTRY InInitializationOrderLinks;
    PVOID DllBase;
	PVOID EntryPoint;
	DWORD SizeOfImage;
    UNICODE_STRING FullDllName;
    UNICODE_STRING BaseDllName;
} LDR_DATA_TABLE_ENTRY, *PLDR_DATA_TABLE_ENTRY;

typedef struct _PEB_LDR_DATA {
    BYTE Reserved1[8];
    PVOID Reserved2[3];
    LIST_ENTRY InMemoryOrderModuleList;
} PEB_LDR_DATA, *PPEB_LDR_DATA;

typedef struct _PEB {
    BYTE Reserved1[2];
    BYTE BeingDebugged;
    BYTE Reserved2[1];
    PVOID Reserved3[2];
    PPEB_LDR_DATA Ldr;
} PEB, *PPEB;

typedef ULONG_PTR (WINAPI * REFLECTIVELOADER)( VOID );
typedef BOOL (WINAPI * DLLMAIN)( HINSTANCE, DWORD, LPVOID );

#define DLLEXPORT   __declspec( dllexport ) 

